# SNI研究の現状調査・新規性・今後のフェーズに関する報告書

日付: 2025-12-15
対象: `doc/theory` ドキュメント群および Web調査結果

## 1. SNI研究の潮流と「流行り」

Web調査および既存文献（SPECTECTOR, Wu & Wang, LightSLH等）の分析から、現在の Spectre 対策・検証研究の潮流は以下のように整理できます。

### メインストリーム: "Soundness" と "Scalability" のジレンマ
*   **SPECTECTOR (2020頃〜):**
    *   **立ち位置:** SNI (Speculative Non-Interference) の定義を確立した「ゴールドスタンダード」。
    *   **手法:** シンボリック実行。
    *   **課題:** パス爆発問題。小さなガジェットの検証には最適だが、実規模のコードベース（OSカーネルや暗号ライブラリ全体）への適用は「タイムアウト」との戦いであり、スケーラビリティが限界に達しています。
*   **抽象解釈・型システム (最近のトレンド):**
    *   **立ち位置:** 実用的なスケーラビリティを確保するためのアプローチ。
    *   **手法:** プログラムをグラフや抽象ドメインで近似する。
    *   **課題:** そのまま適用すると「投機実行の文脈（どこまで投機か、いつロールバックするか）」を扱いきれず、**偽陽性（False Positive）** が多発するか、精度を求めて **解析麻痺（Analysis Paralysis）** に陥る（すべてが Taint される）問題があります。

### プロジェクトの立ち位置
今回のプロジェクト（VCFG + 関係抽象解釈 + 投機コンテキストスタック）は、この **「SPECTECTOR の精度」と「静的解析のスケーラビリティ」の間のギャップ** を埋める、非常に現代的かつ需要の高いポジションに位置しています。

## 2. 本研究の「新規性」の所在

調査に基づくと、本プロジェクトの新規性は以下の「組み合わせ」と「具体化」にあります。単なる既存手法の流用ではありません。

1.  **「投機コンテキストスタック」による VCFG の精密化**
    *   Wu & Wang は VCFG を「キャッシュ解析（WCET）」のために提案しましたが、今回のプロジェクトはこれを **「情報フロー解析（SNI）」** に転用しています。
    *   **新規性の核:** キャッシュ解析では「アクセスしたかどうか」がわかれば十分な場合が多いですが、SNIでは「値の依存関係」が重要です。本研究が提案する **「投機コンテキストスタック（$\Pi^\#$）」** は、共有ノード問題（NSとSPでノードが混ざる問題）を解決し、抽象解釈でありながらハードウェアに近い文脈感度を実現している点が強い新規性です。

2.  **関係抽象ドメイン ($\mathcal{L}_{SNI}$) の設計**
    *   単なる Taint (High/Low) ではなく、NS実行とSP実行の「関係（EqLow, Leak, Diverge）」を第一級市民として扱うドメイン設計は、SPECTECTOR の SNI 定義を抽象解釈で「健全に（見逃しなく）」扱うための理論的カギです。これを VCFG 上の不動点計算として定式化した点は、論文としての主要な貢献になり得ます。

## 3. 現在の研究フェーズと「今やるべきこと」

ユーザーからの「現在はどんなフェーズにいるのか？」という問いに対する回答は以下の通りです。

**現在のフェーズ: 「理論的枠組みの検証」から「プロトタイプによる概念実証」への移行期**

まだ「性能の限界を確かめる（パフォーマンステスト）」や「網羅的なテストケースでバグ出し」をするフェーズ（＝実装完了後のフェーズ）には **至っていません**。
むしろ、理論が「本当に意図通り動くか」を **最小限の定義（契約）** の上で確認する段階です。

### 具体的なフェーズ診断

1.  **アルゴリズムの証明フェーズか？**
    *   はい、部分的にそうです。特に **「正解（Ground Truth）」の定義** がまだ揺らいでいます（`2025-12-14-research_status_and_next_steps.md` で指摘されている点）。
    *   「何をもって Leak とするのか（観測モデル）」を固定しないと、アルゴリズムが正しいかどうかさえ判定できません。

2.  **テストケースで健全性を確かめるフェーズか？**
    *   これから入るべきフェーズです。ただし、**「ランダムにたくさんテストする」のではなく、「論点を突く少数のテスト」が必要** です。
    *   例えば、「投機深さが浅ければ検知できるが、深いと見逃すケース」や「ポインタが絡むと誤検知するケース」など、**モデルの弱点** をあぶり出すためのテストケースを設計する段階です。

### 今後のアクションプラン（構成案）

`2025-12-14-research_status_and_next_steps.md` の内容と整合しますが、研究として進めるなら以下が推奨されます。

1.  **定義の固定（The Contract）**
    *   **SNIへの忠実性:** 正解基準（Ground Truth）は、原則として **SPECTECTOR が採用する SNI 定義に忠実に準拠** します。
    *   **重要な差異 (Length vs Depth):** ただし一点のみ明確な差異として、SPECTECTOR が投機ウィンドウを「深さ（分岐ネスト数）」で定義するのに対し、本アルゴリズムでは **「長さ（命令実行ステップ数）」** で定義します。この差異は意図的なものであり、この前提の上での「正解」を定義します。

2.  **「ゴールデンセット（小規模正解データ）」の作成**
    *   手計算、または SPECTECTOR が通るなら SPECTECTOR の結果を正解とした、小さなアセンブリコード群（5〜10個程度）を用意する。
    *   これが無いと、実装したツールの FP/FN を議論できません。

3.  **比較評価の実装**
    *   実装したアルゴリズムをゴールデンセットに流し、「理論通りに Leak を検出できるか」「理論通りに安全判定できるか」を確認する。
    *   まずはこの「小規模での健全性確認」が完了して初めて、「大規模コードでの限界性能」や「実用性」のフェーズに進めます。

## 結論

*   **方向性:** 間違っていません。業界トレンド（抽象解釈による Spectre 解析）の最先端に位置しており、特に「コンテキストスタック」導入による精度向上は強力な武器（新規性）になります。
*   **現在地:** 理論構築はほぼ完了し、それを「測定可能な形」に落とし込むフェーズです。
*   **次の一手:** 曖昧な定義（観測モデルなど）をエイっと決めてしまい、正解付きの小さなテストセットを作ること。これが研究を前に進める最短ルートです。
