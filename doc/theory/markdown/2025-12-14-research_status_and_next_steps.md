# 研究現状と次の研究ステップ（クリティカル論点のみ / 2025-12-14）

## 前提（この文書の役割）
`doc/theory/` 配下の既存ノートを読んだ上で研究を進める前提とし、本書は **重複を避ける**。
ここでは「既存ノートだけでは決まり切っていないが、研究の成否を左右する決定事項」と
「それを前に進めるための最短ステップ」だけを記録する。

詳細な理論（VCFG・格子・履歴更新則・アルゴリズム形式化など）は、既存ノートを参照すること。

---

## 0. 2025-12-14 時点で固定した前提（研究“契約”の確定部分）
以下は研究の議論を進めるための **固定事項** として扱う。

1. **投機モデルは Pruning 型**
   - 有限の投機長 `W_max` を置き、その範囲外の投機実行は探索対象外とする。
   - 以降の「安全/脆弱」の主張は、原則として `W_max` に条件付く（`W_max` を超える投機を許す実機では射程外になり得る）。

2. **投機の制限は“深さ”ではなく“長さ”で定義する**
   - ここでの長さとは、投機中に実行される命令ステップ数に基づく上限を意味する。
   - 深さ（分岐ネストなど）で測る別モデルもあり得るが、当面は扱わない。

3. **SNI の定義は SPECTECTOR 論文と同一にする**
   - 研究の主張は「SPECTECTOR が提案した SNI を、より早く（より実用的に）検出する」に寄せる。
   - したがって SNI そのものの定義（観測オラクル・ポリシ・初期状態の同値など）を恣意的に変更しない。

4. **投機バリア（spbarr）を研究対象に含める**
   - 研究上の意味論として、バリア以降は「投機として実行されない（投機観測が発生しない）」ことを表現対象に含める。

## 1. 研究現状（= いま詰まっている“未決定”の核）

### 1.1 FP/FN 議論の前提が未固定
**偽陽性/偽陰性（FP/FN）**は、参照する「正解（ground truth）」と
その正解が依存する **投機モデル・観測モデル**が固定されない限り、定義できない。

したがって現時点の研究フェーズは、
「ケースを増やして FP/FN を数える」よりも先に、
**“正解”を生成する契約（モデル仮定と参照手順）を文書化して固定する**段階が含まれる。

### 1.2 モデル差分が結果を支配する主要論点（最重要）
既存ノートが示す複数の設計選択のうち、次は研究結論の範囲（何が言えるか）を直接決める。

1. **観測モデル（何を観測とみなすか）**
   - MEMLEAK: 位置（アドレス/ロケーション）だけか、値も含めるか。
   - CTRLLEAK: 条件値だけか、分岐方向も含めるか、ターゲットも含めるか。
   - どれを採るかで “Leak” の意味にズレが生じるため、FP/FN の意味も変わる。

2. **観測キー粒度（履歴のキー空間）**
   - キーが細かいほど「ベースラインとの差分」が弱まりやすく、逆に粗いほど混同が増える。
   - ここは “設計上のトレードオフ” ではなく、**研究主張の前提**として固定する必要がある。

3. **“正解（ground truth）”生成プロトコル**
   - どのモデル仮定（`W_max`・観測モデル・観測キー・バリア意味論）に基づく正解なのかを固定しない限り、
     FP/FN は比較不能になる。
   - 少なくとも小規模ケースについては、参照手順（列挙/判定/同値基準）を決める必要がある。

---

## 2. 次の研究ステップ（最短手順）

### ステップ A: 研究の“契約書”の残りを 1 ページで固定する
以下を **Yes/No と定義**で固定する（長い議論は他ノートに逃がしてよい）。

- 観測モデル: MEMLEAK と CTRLLEAK の観測対象（何を観測と見なすか）
- 観測キー: `K_mem, K_ctrl` の定義（粒度・区別したい同一性）
- `W_max` の位置づけ: 実機仮定 / パラメータ掃引 / 解析上の制限（主張の射程に直結）
- ground truth: 参照手順（列挙・同値基準・ラベリング）と適用範囲

この 1 ページが固定されると、以降の FP/FN 議論と健全性主張が「どのモデルについての主張か」明確になる。

### ステップ B: “正解”生成プロトコルを固定する（小規模から）
FP/FN を語るために、少なくとも小規模ケースについては次を固定する。

- 参照手順: 例）投機長 `W_max` を含む到達可能な実行を列挙し、観測トレース同値/差分で判定する
- 適用範囲: 例）ループ回数が有限に切れるケース、分岐が浅いケース等
- 参照不能領域の扱い: 例）大規模は “既知パターン＋部分列挙＋手動根拠” として別枠にする

**重要:** 参照手順が固定されないままの “FP/FN” は、単なる感想（解釈）になりやすい。

### ステップ C: ケース体系を「モデル差分が見える形」で作る
ケースを増やす目的は “数” ではなく、次の疑問に答えること。

- どの論点（投機モデル/観測モデル/キー粒度/バリア）を変えると結論が反転するか
- 反転するなら、それは “モデル差分として正しい” のか、それとも近似の粗さによる FP/FN なのか

そのために各ケースには最低限次を付与する。

- 期待ラベル（Secure/Violation）**と、その期待が依存する仮定**（モデル・`W_max`・観測定義）
- 反転可能性（どの仮定を変えると反転し得るか）

### ステップ D: 主張の形を決める（研究としての出し方）
最後に、研究成果を次のどちらとして出すかを明確化する（混ぜると主張が散る）。

- **検出器**（脆弱性の可能性を広く拾う、FP は許容）
- **認証/正当化**（緩和策込みで “安全” を示したい、モデルと健全性の文書化が必須）

---

## 3. 研究上のリスク（このメモで残すべき最低限）
- `W_max`（投機長）の仮定は、主張の射程そのものを変える（モデル依存性）。
- 観測モデルと観測キーの定義は、Leak 判定の意味を変える（比較不能性のリスク）。
- バリア/緩和策を扱わない場合、実運用上の「安全」と乖離する可能性がある（研究の限界として明示が必要）。
